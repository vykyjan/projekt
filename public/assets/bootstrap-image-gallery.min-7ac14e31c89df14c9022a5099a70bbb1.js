!function(e){"function"==typeof define&&define.amd?define(["jquery","./load-image.js","bootstrap"],e):e(window.jQuery,window.loadImage)}(function(e,t){e.extend(e.fn.modal.defaults,{delegate:document,selector:null,index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0});var i=e.fn.modal.Constructor.prototype.show,o=e.fn.modal.Constructor.prototype.hide;e.extend(e.fn.modal.Constructor.prototype,{initLinks:function(){var t=this,i=this.options,o=i.selector||"a[data-target="+i.target+"]",l=0;e(i.delegate).find(o).each(function(o,n){var a=n.href||e(n).data("href");t.urls[t.urls.length-1]!==a&&(t.urls.push(a),t.titles.push(n.title),a===i.href&&(i.index=l),l+=1)}),this.urls[i.index]||(i.index=0)},startSlideShow:function(){var e=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){e.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var e=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=e.data("slideshow")||5e3,this.startSlideShow()),e.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var t,i,o=this.options,l=o.index+o.preloadRange+1;for(i=o.index-o.preloadRange;l>i;i+=1)t=this.urls[i],t&&i!==o.index&&e("<img>").prop("src",t)},loadImage:function(){var e,i=this,o=this.$element,l=this.options.index;this.abortLoad(),this.stopSlideShow(),this._loadingTimeout=window.setTimeout(function(){o.addClass("modal-loading")},100),e=o.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){e.remove()},3e3),o.find(".modal-title").text(this.titles[l]),o.find(".modal-download").prop("href",this.urls[l]),this.loadingImage=t(this.urls[l],function(e){window.clearTimeout(i._loadingTimeout),o.removeClass("modal-loading"),i.showImage(e),i.startSlideShow()},i.loadImageOptions),this.preloadImages()},showImage:function(t){var i,o,l=this.$element,n=e.support.transition&&l.hasClass("fade"),a=n?l.animate:l.css,s=l.find(".modal-image");s.css({width:t.width,height:t.height}),l.find(".modal-title").css({width:Math.max(t.width,380)}),e(window).width()>480&&(n&&(i=l.clone().hide().appendTo(document.body)),a.call(l.stop(),{"margin-top":-((i||l).outerHeight()/2),"margin-left":-((i||l).outerWidth()/2)}),i&&i.remove()),s.append(t),o=t.offsetWidth,e(t).addClass("in")},abortLoad:function(){this.loadingImage&&(this.loadingImage.onload=this.loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var e=this.options;e.index-=1,e.index<0&&(e.index=this.urls.length-1),this.loadImage()},next:function(){var e=this.options;e.index+=1,e.index>this.urls.length-1&&(e.index=0),this.loadImage()},keyHandler:function(e){switch(e.which){case 37:case 38:e.preventDefault(),this.prev();break;case 39:case 40:e.preventDefault(),this.next()}},wheelHandler:function(e){e.preventDefault(),e=e.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=e.wheelDelta||e.detail||0,e.wheelDelta&&this._wheelCounter>=120||!e.wheelDelta&&this._wheelCounter<0?(this.prev(),this._wheelCounter=0):(e.wheelDelta&&this._wheelCounter<=-120||!e.wheelDelta&&this._wheelCounter>0)&&(this.next(),this._wheelCounter=0)},initGalleryEvents:function(){var t=this,i=this.$element;i.find(".modal-image").on("click.modal-gallery",function(e){e.altKey?t.prev(e):t.next(e)}),i.find(".modal-prev").on("click.modal-gallery",function(e){t.prev(e)}),i.find(".modal-next").on("click.modal-gallery",function(e){t.next(e)}),i.find(".modal-slideshow").on("click.modal-gallery",function(e){t.toggleSlideShow(e)}),e(document).on("keydown.modal-gallery",function(e){t.keyHandler(e)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(e){t.wheelHandler(e)})},destroyGalleryEvents:function(){var t=this.$element;this.abortLoad(),this.stopSlideShow(),t.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),e(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var t=this.$element,o=this.options,l=e(window).width(),n=e(window).height();this.urls=[],this.titles=[],this.loadImageOptions=t.hasClass("modal-fullscreen")?{minWidth:l,minHeight:n,maxWidth:l,maxHeight:n,canvas:o.canvas}:{maxWidth:l-o.offsetWidth,maxHeight:n-o.offsetHeight,canvas:o.canvas},l>480&&t.css({"margin-top":-(t.outerHeight()/2),"margin-left":-(t.outerWidth()/2)}),this.initGalleryEvents(),this.initLinks(),this.urls.length&&this.loadImage()}i.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),o.apply(this,arguments)}}),e(function(){e(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(t){var i,o=e(this),l=o.data(),n=e(l.target),a=n.data("modal");a||(l=e.extend(n.data(),l)),l.selector||(l.selector="a[rel=gallery]"),i=e(t.target).closest(l.selector),i.length&&n.length&&(t.preventDefault(),l.href=i.prop("href")||i.data("href"),l.delegate=i[0]!==this?this:document,a&&e.extend(a.options,l),n.modal(l))})})});