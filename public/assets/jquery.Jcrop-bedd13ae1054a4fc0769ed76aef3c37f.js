!function(e){e.Jcrop=function(t,n){function o(e){return parseInt(e,10)+"px"}function r(e){return parseInt(e,10)+"%"}function a(e){return B.baseClass+"-"+e}function s(){return e.fx.step.hasOwnProperty("backgroundColor")}function i(t){var n=e(t).offset();return[n.left,n.top]}function c(e){return[e.pageX-j[0],e.pageY-j[1]]}function u(t){"object"!=typeof t&&(t={}),B=e.extend(B,t),"function"!=typeof B.onChange&&(B.onChange=function(){}),"function"!=typeof B.onSelect&&(B.onSelect=function(){}),"function"!=typeof B.onRelease&&(B.onRelease=function(){})}function d(e){e!==A&&(pt.setCursor(e),A=e)}function l(e,t){if(j=i(q),pt.setCursor("move"===e?e:e+"-resize"),"move"===e)return pt.activateHandlers(p(t),C);var n=ft.getFixed(),o=g(e),r=ft.getCorner(g(o));ft.setPressed(ft.getCorner(o)),ft.setCurrent(r),pt.activateHandlers(f(e,n),C)}function f(e,t){return function(n){if(B.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}ft.setCurrent(n),ht.update()}}function p(e){var t=e;return gt.watchKeys(),function(e){ft.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,ht.update()}}function g(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function b(e){return function(t){return B.disabled?!1:"move"!==e||B.allowMove?(at=!0,l(e,c(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}function v(e,t,n){var o=e.width(),r=e.height();o>t&&t>0&&(o=t,r=t/e.width()*e.height()),r>n&&n>0&&(r=n,o=n/e.height()*e.width()),ot=e.width()/o,rt=e.height()/r,e.width(o).height(r)}function m(e){return{x:parseInt(e.x*ot,10),y:parseInt(e.y*rt,10),x2:parseInt(e.x2*ot,10),y2:parseInt(e.y2*rt,10),w:parseInt(e.w*ot,10),h:parseInt(e.h*rt,10)}}function C(){var e=ft.getFixed();e.w>B.minSelect[0]&&e.h>B.minSelect[1]?(ht.enableHandles(),ht.done()):ht.release(),pt.setCursor(B.allowSelect?"crosshair":"default")}function S(e){if(B.disabled)return!1;if(!B.allowSelect)return!1;at=!0,j=i(q),ht.disableHandles(),d("crosshair");var t=c(e);return ft.setPressed(t),ht.update(),pt.activateHandlers(I,C),gt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function I(e){ft.setCurrent(e),ht.update()}function k(){var t=e("<div></div>").addClass(a("tracker"));return e.browser.msie&&t.css({opacity:0,backgroundColor:"white"}),t}function z(e){L.removeClass().addClass(a("holder")).addClass(e)}function O(e,t){function n(){window.setTimeout(v,l)}var o=parseInt(e[0],10)/ot,r=parseInt(e[1],10)/rt,a=parseInt(e[2],10)/ot,s=parseInt(e[3],10)/rt;if(!st){var i=ft.flipCoords(o,r,a,s),c=ft.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=B.animationDelay,f=i[0]-u[0],h=i[1]-u[1],p=i[2]-u[2],g=i[3]-u[3],w=0,b=B.swingSpeed;x=d[0],y=d[1],a=d[2],s=d[3],ht.animMode(!0);var v=function(){return function(){w+=(100-w)/b,d[0]=x+w/100*f,d[1]=y+w/100*h,d[2]=a+w/100*p,d[3]=s+w/100*g,w>=99.8&&(w=100),100>w?(T(d),n()):(ht.done(),"function"==typeof t&&t.call(wt))}}();n()}}function M(e){T([parseInt(e[0],10)/ot,parseInt(e[1],10)/rt,parseInt(e[2],10)/ot,parseInt(e[3],10)/rt])}function T(e){ft.setPressed([e[0],e[1]]),ft.setCurrent([e[2],e[3]]),ht.update()}function H(){return m(ft.getFixed())}function P(){return ft.getFixed()}function F(e){u(e),X()}function D(){B.disabled=!0,ht.disableHandles(),ht.setCursor("default"),pt.setCursor("default")}function E(){B.disabled=!1,X()}function R(){ht.done(),pt.activateHandlers(null,null)}function J(){L.remove(),V.show(),e(t).removeData("Jcrop")}function Y(e,t){ht.release(),D();var n=new Image;n.onload=function(){var o=n.width,r=n.height,a=B.boxWidth,s=B.boxHeight;q.width(o).height(r),q.attr("src",e),N.attr("src",e),v(q,a,s),Q=q.width(),G=q.height(),N.width(Q).height(G),ut.width(Q+2*ct).height(G+2*ct),L.width(Q).height(G),E(),"function"==typeof t&&t.call(wt)},n.src=e}function X(e){B.allowResize?e?ht.enableOnly():ht.enableHandles():ht.disableHandles(),pt.setCursor(B.allowSelect?"crosshair":"default"),ht.setCursor(B.allowMove?"move":"default"),B.hasOwnProperty("setSelect")&&(M(B.setSelect),ht.done(),delete B.setSelect),B.hasOwnProperty("trueSize")&&(ot=B.trueSize[0]/Q,rt=B.trueSize[1]/G),B.hasOwnProperty("bgColor")&&(s()&&B.fadeTime?L.animate({backgroundColor:B.bgColor},{queue:!1,duration:B.fadeTime}):L.css("backgroundColor",B.bgColor),delete B.bgColor),B.hasOwnProperty("bgOpacity")&&(dt=B.bgOpacity,ht.isAwake()&&(B.fadeTime?q.fadeTo(B.fadeTime,dt):L.css("opacity",B.opacity)),delete B.bgOpacity),_=B.maxSize[0]||0,et=B.maxSize[1]||0,tt=B.minSize[0]||0,nt=B.minSize[1]||0,B.hasOwnProperty("outerImage")&&(q.attr("src",B.outerImage),delete B.outerImage),ht.refresh()}var j,A,B=e.extend({},e.Jcrop.defaults),K=!1;e.browser.msie&&"6"===e.browser.version.split(".")[0]&&(K=!0),"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),u(n);var W={border:"none",margin:0,padding:0,position:"absolute"},V=e(t),q=V.clone().removeAttr("id").css(W);q.width(V.width()),q.height(V.height()),V.after(q).hide(),v(q,B.boxWidth,B.boxHeight);var Q=q.width(),G=q.height(),L=e("<div />").width(Q).height(G).addClass(a("holder")).css({position:"relative",backgroundColor:B.bgColor}).insertAfter(V).append(q);delete B.bgColor,B.addClass&&L.addClass(B.addClass);var N=e("<img />").attr("src",q.attr("src")).css(W).width(Q).height(G),U=e("<div />").width(r(100)).height(r(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(N),Z=e("<div />").width(r(100)).height(r(100)).css("zIndex",320),$=e("<div />").css({position:"absolute",zIndex:300}).insertBefore(q).append(U,Z);K&&$.css({overflowY:"hidden"});var _,et,tt,nt,ot,rt,at,st,it,ct=B.boundary,ut=k().width(Q+2*ct).height(G+2*ct).css({position:"absolute",top:o(-ct),left:o(-ct),zIndex:290}).mousedown(S),dt=B.bgOpacity;j=i(q);var lt=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r=n[e];r="on"+r;var a=r in o;a||(o.setAttribute(r,"return;"),a="function"==typeof o[r]),t[n[e]]=a}return t.touchstart&&t.touchend&&t.touchmove}catch(s){return!1}}function t(){return B.touchSupport===!0||B.touchSupport===!1?B.touchSupport:e()}return{createDragger:function(e){return function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,B.disabled?!1:"move"!==e||B.allowMove?(at=!0,l(e,c(t)),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,S(e)},isSupported:e,support:t()}}(),ft=function(){function e(e){e=s(e),g=f=e[0],b=p=e[1]}function t(e){e=s(e),d=e[0]-g,l=e[1]-b,g=e[0],b=e[1]}function n(){return[d,l]}function o(e){var t=e[0],n=e[1];0>f+t&&(t-=t+f),0>p+n&&(n-=n+p),b+n>G&&(n+=G-(b+n)),g+t>Q&&(t+=Q-(g+t)),f+=t,g+=t,p+=n,b+=n}function r(e){var t=a();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function a(){if(!B.aspectRatio)return c();var e,t,n=B.aspectRatio,o=B.minSize[0]/ot,r=B.maxSize[0]/ot,a=B.maxSize[1]/rt,s=g-f,d=b-p,l=Math.abs(s),v=Math.abs(d),m=l/v;return 0===r&&(r=10*Q),0===a&&(a=10*G),n>m?(t=b,w=v*n,e=0>s?f-w:w+f,0>e?(e=0,h=Math.abs((e-f)/n),t=0>d?p-h:h+p):e>Q&&(e=Q,h=Math.abs((e-f)/n),t=0>d?p-h:h+p)):(e=g,h=l/n,t=0>d?p-h:p+h,0>t?(t=0,w=Math.abs((t-p)*n),e=0>s?f-w:w+f):t>G&&(t=G,w=Math.abs(t-p)*n,e=0>s?f-w:w+f)),e>f?(o>e-f?e=f+o:e-f>r&&(e=f+r),t=t>p?p+(e-f)/n:p-(e-f)/n):f>e&&(o>f-e?e=f-o:f-e>r&&(e=f-r),t=t>p?p+(f-e)/n:p-(f-e)/n),0>e?(f-=e,e=0):e>Q&&(f-=e-Q,e=Q),0>t?(p-=t,t=0):t>G&&(p-=t-G,t=G),u(i(f,p,e,t))}function s(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>Q&&(e[0]=Q),e[1]>G&&(e[1]=G),[e[0],e[1]]}function i(e,t,n,o){var r=e,a=n,s=t,i=o;return e>n&&(r=n,a=e),t>o&&(s=o,i=t),[Math.round(r),Math.round(s),Math.round(a),Math.round(i)]}function c(){var e,t=g-f,n=b-p;return _&&Math.abs(t)>_&&(g=t>0?f+_:f-_),et&&Math.abs(n)>et&&(b=n>0?p+et:p-et),nt/rt&&Math.abs(n)<nt/rt&&(b=n>0?p+nt/rt:p-nt/rt),tt/ot&&Math.abs(t)<tt/ot&&(g=t>0?f+tt/ot:f-tt/ot),0>f&&(g-=f,f-=f),0>p&&(b-=p,p-=p),0>g&&(f-=g,g-=g),0>b&&(p-=b,b-=b),g>Q&&(e=g-Q,f-=e,g-=e),b>G&&(e=b-G,p-=e,b-=e),f>Q&&(e=f-G,b-=e,p-=e),p>G&&(e=p-G,b-=e,p-=e),u(i(f,p,g,b))}function u(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var d,l,f=0,p=0,g=0,b=0;return{flipCoords:i,setPressed:e,setCurrent:t,getOffset:n,moveOffset:o,getCorner:r,getFixed:a}}(),ht=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:B.borderOpacity}).addClass(a(t));return U.append(n),n}function n(t,n){var o=e("<div />").mousedown(b(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n});return lt.support&&o.bind("touchstart",lt.createDragger(t)),Z.append(o),o}function s(e){return n(e,z++).css({top:o(-H+1),left:o(-H+1),opacity:B.handleOpacity}).addClass(a("handle"))}function i(e){var t=B.handleSize,a=t,s=t,i=H,c=H;switch(e){case"n":case"s":s=r(100);break;case"e":case"w":a=r(100)}return n(e,z++).width(s).height(a).css({top:o(-i+1),left:o(-c+1)})}function c(e){var t;for(t=0;t<e.length;t++)M[e[t]]=s(e[t])}function u(e){var t=Math.round(e.h/2-H),n=Math.round(e.w/2-H),r=e.w-H,a=e.h-H;M.e&&(M.e.css({top:o(t),left:o(r)}),M.w.css({top:o(t)}),M.s.css({top:o(a),left:o(n)}),M.n.css({left:o(n)})),M.ne&&(M.ne.css({left:o(r)}),M.se.css({top:o(a),left:o(r)}),M.sw.css({top:o(a)})),M.b&&(M.b.css({top:o(a)}),M.r.css({left:o(r)}))}function d(e,t){N.css({top:o(-t),left:o(-e)}),$.css({top:o(t),left:o(e)})}function l(e,t){$.width(e).height(t)}function f(){var e=ft.getFixed();ft.setPressed([e.x,e.y]),ft.setCurrent([e.x2,e.y2]),h()}function h(){return I?p():void 0}function p(){var e=ft.getFixed();l(e.w,e.h),d(e.x,e.y),T&&u(e),I||g(),B.onChange.call(wt,m(e))}function g(){$.show(),B.bgFade?q.fadeTo(B.fadeTime,dt):q.css("opacity",dt),I=!0}function w(){x(),$.hide(),B.bgFade?q.fadeTo(B.fadeTime,1):q.css("opacity",1),I=!1,B.onRelease.call(wt)}function v(){T&&(u(ft.getFixed()),Z.show())}function y(){return T=!0,B.allowResize?(u(ft.getFixed()),Z.show(),!0):void 0}function x(){T=!1,Z.hide()}function C(e){st===e?x():y()}function S(){C(!1),f()}var I,z=370,O={},M={},T=!1,H=B.handleOffset;B.drawBorders&&(O={top:t("hline"),bottom:t("hline bottom"),left:t("vline"),right:t("vline right")}),B.dragEdges&&(M.t=i("n"),M.b=i("s"),M.r=i("e"),M.l=i("w")),B.sideHandles&&c(["n","s","e","w"]),B.cornerHandles&&c(["sw","nw","ne","se"]);var P=k().mousedown(b("move")).css({cursor:"move",position:"absolute",zIndex:360});return lt.support&&P.bind("touchstart.jcrop",lt.createDragger("move")),U.append(P),x(),{updateVisible:h,update:p,release:w,refresh:f,isAwake:function(){return I},setCursor:function(e){P.css("cursor",e)},enableHandles:y,enableOnly:function(){T=!0},showHandles:v,disableHandles:x,animMode:C,done:S}}(),pt=function(){function t(){ut.css({zIndex:450}),f&&e(document).bind("mousemove",o).bind("mouseup",r)}function n(){ut.css({zIndex:290}),f&&e(document).unbind("mousemove",o).unbind("mouseup",r)}function o(e){return d(c(e)),!1}function r(e){return e.preventDefault(),e.stopPropagation(),at&&(at=!1,l(c(e)),ht.isAwake()&&B.onSelect.call(wt,m(ft.getFixed())),n(),d=function(){},l=function(){}),!1}function a(e,n){return at=!0,d=e,l=n,t(),!1}function s(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,o(e)}function i(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,r(e)}function u(e){ut.css("cursor",e)}var d=function(){},l=function(){},f=B.trackDocument;return lt.support&&e(document).bind("touchmove",s).bind("touchend",i),f||ut.mousemove(o).mouseup(r).mouseout(r),q.before(ut),{activateHandlers:a,setCursor:u}}(),gt=function(){function t(){B.keySupport&&(a.show(),a.focus())}function n(){a.hide()}function o(e,t,n){B.allowMove&&(ft.moveOffset([t,n]),ht.updateVisible()),e.preventDefault(),e.stopPropagation()}function r(e){if(e.ctrlKey)return!0;it=e.shiftKey?!0:!1;var t=it?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:ht.release();break;case 9:return!0}return!1}var a=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),s=e("<div />").css({position:"absolute",overflow:"hidden"}).append(a);return B.keySupport&&(a.keydown(r).blur(n),K||!B.fixedSupport?(a.css({position:"absolute",left:"-20px"}),s.append(a).insertBefore(q)):a.insertBefore(q)),{watchKeys:t}}();lt.support&&ut.bind("touchstart",lt.newSelection),Z.hide(),X(!0);var wt={setImage:Y,animateTo:O,setSelect:M,setOptions:F,tellSelect:H,tellScaled:P,setClass:z,disable:D,enable:E,cancel:R,release:ht.release,destroy:J,focus:gt.watchKeys,getBounds:function(){return[Q*ot,G*rt]},getWidgetSize:function(){return[Q,G]},getScaleFactor:function(){return[ot,rt]},ui:{holder:L,selection:$}};return e.browser.msie&&L.bind("selectstart",function(){return!1}),V.data("Jcrop",wt),wt},e.fn.Jcrop=function(t,n){function o(o){var r="object"==typeof t?t:{},a=r.useImg||o.src,s=new Image;s.onload=function(){function t(){var t=e.Jcrop(o,r);"function"==typeof n&&n.call(t)}function a(){s.width&&s.height?t():window.setTimeout(a,50)}window.setTimeout(a,50)},s.src=a}return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else o(this)}),this},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:9,handleOffset:5,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onRelease:function(){}}}(jQuery);