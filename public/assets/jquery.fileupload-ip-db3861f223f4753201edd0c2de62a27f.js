!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],e):e(window.jQuery,window.loadImage,window.canvasToBlob)}(function(e,i,s){"use strict";e.widget("blueimpIP.fileupload",e.blueimp.fileupload,{options:{resizeSourceFileTypes:/^image\/(gif|jpeg|png)$/,resizeSourceMaxFileSize:2e7,resizeMaxWidth:void 0,resizeMaxHeight:void 0,resizeMinWidth:void 0,resizeMinHeight:void 0,add:function(i,s){e(this).fileupload("resize",s).done(function(){s.submit()})}},_resizeImage:function(t,n,r){var o,a=this,u=t[n],p=e.Deferred();return r=r||this.options,i(u,function(e){var c=e.width,d=e.height;o=i.scale(e,{maxWidth:r.resizeMaxWidth,maxHeight:r.resizeMaxHeight,minWidth:r.resizeMinWidth,minHeight:r.resizeMinHeight,canvas:!0}),c!==o.width||d!==o.height?s(o,function(e){e.name||(u.type===e.type?e.name=u.name:u.name&&(e.name=u.name.replace(/\..+$/,"."+e.type.substr(6)))),t[n]=e,p.resolveWith(a)},u):p.resolveWith(a)}),p.promise()},resize:function(i){var s=this,t=e.extend({},this.options,i),n="number"!==e.type(t.resizeSourceMaxFileSize),r=this._isXHRUpload(t);return e.each(i.files,function(o,a){r&&s._resizeSupport&&(t.resizeMaxWidth||t.resizeMaxHeight||t.resizeMinWidth||t.resizeMinHeight)&&(n||a.size<t.resizeSourceMaxFileSize)&&t.resizeSourceFileTypes.test(a.type)&&(s._processing+=1,1===s._processing&&s.element.addClass("fileupload-processing"),s._processingQueue=s._processingQueue.pipe(function(){var n=e.Deferred();return s._resizeImage(i.files,o,t).done(function(){s._processing-=1,0===s._processing&&s.element.removeClass("fileupload-processing"),n.resolveWith(s)}),n.promise()}))}),this._processingQueue},_create:function(){e.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise(),this._resizeSupport=s&&s(document.createElement("canvas"),e.noop)}})});